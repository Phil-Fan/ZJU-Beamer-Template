% Copyright 2009 by Pim Vullers
% Modified 2023-08-22 by [光头哥]
% Modified 2025-07-10 by [PhilFan]
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License (LPPL), either version 1.3c
%    or (at your option) any later version.
% 2. under the GNU Public License (GPL), either version 3
%    or (at your option) any later version.
%
% This work is derived from the original `zju` package (by 光头哥).
% The modified version is identified by the name '[zju_beamer]'
% to avoid confusion with the original work.

%%%%-----导入宏包-----%%%%
\ProvidesPackage{zju_beamer}  
% 导入必要的宏包
\RequirePackage{fontspec} % 提供字体选择功能
\RequirePackage{xeCJK} % 提供更完善的中文支持
\RequirePackage[fontset=none]{ctex} % 提供中文支持
\RequirePackage{amsmath,amsfonts,amssymb,bm} % 数学公式相关宏包
\RequirePackage{graphicx,hyperref,url} % 图片、超链接支持
\RequirePackage{metalogo} % metalogo图标，例如\XeLaTeX
\RequirePackage{lipsum} % 用于生成填充文本
\RequirePackage{listings} % 代码高亮显示
% \RequirePackage{xcolor}
\RequirePackage[dvipsnames]{xcolor} % 提供颜色设置的功能，`dvipsnames` 选项允许使用更多预定义的颜色名称。
\RequirePackage{subcaption} % 用于创建并排图片
\RequirePackage{multicol} % 多栏环境支持
\RequirePackage{caption} % 图表标题定制
\RequirePackage{fancyhdr} % 页眉页脚定制
\RequirePackage{tcolorbox} % 创建彩色文本框


\catcode`\。=\active         %或者=13
\newcommand{。}{．}				
%将正文中的“。”号转换为“.”。中文标点国家规范建议科技文献中的句号用圆点替代

%%% Inherit definitions from existing themes (DO NOT MODIFY THESE)
%%%
\useoutertheme{split} % 分割式头部和尾部布局
\usecolortheme{whale} % 使用鲸鱼色彩主题，为外部元素提供背景色
\useinnertheme{rounded} % 内部元素使用圆角布局
\usecolortheme{orchid} % 使用兰花色彩主题，为内部元素提供前景色

%%%
%%% Tweak definitions of inner theme to match personal preferences (MODIFY THESE)
%%%

\setbeamertemplate{itemize items}[circle] % 列表项目符号为圆圈
\setbeamertemplate{enumerate items}[circle] % 枚举项目符号为圆圈
\setbeamertemplate{sections/subsections in toc}[default] % 目录中的章节/小节使用默认样式

% General blocks: 使用圆角样式的方块
\setbeamertemplate{blocks}[rounded] % 

% Title page: 标题页样式
\setbeamertemplate{title page}[default][colsep=-4bp,rounded=true] % 
% Part page: 部分页样式
\setbeamertemplate{part page}[default][colsep=-4bp,rounded=true] % 
% Navigation symbols:
% \setbeamertemplate{navigation symbols}{} % 可以取消注释来隐藏导航符号

%%%
%%% Tweak definitions of outer theme to match Radboud (website) style
%%%

% Background
\pgfdeclareimage[width=\paperwidth,height=\paperheight]{bg}{figures/background.png} % 定义背景图像
\setbeamertemplate{background}{\pgfuseimage{bg}} % 应用背景图像

% Colors 自定义结构色彩主题{structure}
\usecolortheme[RGB={0,63,136}]{structure}

\setbeamercolor{frametitle}{parent=subsection in head/foot}
\setbeamercolor{frametitle right}{parent=section in head/foot}
\pgfdeclarehorizontalshading[frametitle.bg,frametitle right.bg]{beamer@frametitleshade}{\paperheight}{%
  color(0pt)=(frametitle.bg); color(\paperwidth)=(frametitle right.bg)}



\pgfdeclarehorizontalshading[frametitle.bg,frametitle right.bg]{beamer@frametitleshade}{\paperheight}{%
  color(0pt)=(frametitle.bg);
  color(\paperwidth)=(frametitle right.bg)}

\AtBeginDocument{
  \pgfdeclareverticalshading{beamer@topshade}{\paperwidth}{%
    color(0pt)=(bg);
    color(4pt)=(black!50!bg)}
}

% Footline: AUTHOR | TITLE | DATE FRAMENUMBER
\defbeamertemplate*{footline}{zju theme}{%
  \leavevmode%
  \hbox{%
    \begin{beamercolorbox}[wd=.35\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
      \usebeamerfont{author in head/foot}\insertshortauthor
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
      \usebeamerfont{author in head/foot}\insertshortdate
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.34\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
      \usebeamerfont{title in head/foot}\insertshorttitle
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=0.06\paperwidth,ht=2.25ex,dp=1ex,right]{title in head/foot}%
      \insertframenumber{} / \inserttotalframenumber\hspace*{2ex}
    \end{beamercolorbox}}%
  \vskip0pt%
}

\defbeamertemplate*{headline}{zju theme}{%
  \leavevmode%
  \@tempdimb=6.4375ex%
  %\multiply\@tempdimb by\beamer@sectionmax%
  \pgfdeclareimage[height=.95\@tempdimb]{logo}{figures/logo.png}%
  \pgfdeclareimage[height=\@tempdimb]{title_logo}{figures/char.png}%
  \logo{\pgfuseimage{logo}}%
  \ifdim\@tempdimb>0pt%
    \advance\@tempdimb by 1.125ex%
    \begin{beamercolorbox}[wd=.8\paperwidth,ht=\@tempdimb]{section in head/foot}%
      \vbox to\@tempdimb{\vfil\insertsectionnavigationhorizontal{.5\textwidth}{\hskip0pt plus1filll}{}\vfil}%
    \end{beamercolorbox}%
    %% \begin{beamercolorbox}[wd=.4\paperwidth,ht=\@tempdimb,center]{subsection in head/foot}%
    %%   \vbox to\@tempdimb{\vfil\textbf{\footnotesize\insertshortinstitute~~}\vfil}%
    %% \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.135\paperwidth,ht=\@tempdimb,center]{section in head/foot}%
      \vbox to\@tempdimb{\vfil\pgfuseimage{title_logo}\vfil}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.065\paperwidth,ht=\@tempdimb,center]{section in head/foot}%
      \vbox to\@tempdimb{\vfil\insertlogo\vfil\vfil}%
    \end{beamercolorbox}%
  \fi%
}

\defbeamertemplate*{frametitle}{zju theme}{%
  \nointerlineskip%
  %\vskip-2pt%
  \hbox{\leavevmode
    \advance\beamer@leftmargin by -12bp%
    \advance\beamer@rightmargin by -12bp%
    \beamer@tempdim=\textwidth%
    \advance\beamer@tempdim by \beamer@leftmargin%
    \advance\beamer@tempdim by \beamer@rightmargin%
    \hskip-\Gm@lmargin\hbox{%
      \setbox\beamer@tempbox=\hbox{\begin{minipage}[b]{\paperwidth}%
          \vbox{}\vskip-.75ex%
          \leftskip0.3cm%
          \rightskip0.3cm plus1fil\leavevmode
          \insertframetitle%
          \ifx\insertframesubtitle\@empty%
            \strut\par%
          \else
            \par{\usebeamerfont*{framesubtitle}{\usebeamercolor[fg]{framesubtitle}\insertframesubtitle}\strut\par}%
          \fi%
          \nointerlineskip
          \vbox{}%
        \end{minipage}}%
      \beamer@tempdim=\ht\beamer@tempbox%
      \advance\beamer@tempdim by 2pt%
      \begin{pgfpicture}{0mm}{0pt}{1.01\paperwidth}{\beamer@tempdim}
        \usebeamercolor{frametitle right}
        \pgfpathrectangle{\pgfpointorigin}{\pgfpoint{\paperwidth}{\beamer@tempdim}}
        \pgfusepath{clip}
        \pgftext[left,base]{\pgfuseshading{beamer@frametitleshade}}
      \end{pgfpicture}
      \hskip-\paperwidth%
      \box\beamer@tempbox%
    }%
    \hskip-\Gm@rmargin%
  }%
  %  \nointerlineskip
  %    \vskip-0.2pt
  %    \hbox to\textwidth{\hskip-\Gm@lmargin\pgfuseshading{beamer@topshade}\hskip-\Gm@rmargin}
  %    \vskip-2pt
}

% 代码显示
\lstset{
    language=Tex, % 设置语言
    backgroundcolor=\color{white}, 
    basicstyle=\ttfamily, % 设置字体族
    breaklines=true, % 自动换行
    keywordstyle=\bfseries\color{NavyBlue}, % 设置关键字为粗体，颜色为 NavyBlue
    morekeywords={}, % 设置更多的关键字，用逗号分隔
    emph={self}, % 指定强调词，如果有多个，用逗号隔开
    emphstyle=\bfseries\color{Rhodamine}, % 强调词样式设置
    commentstyle=\itshape\color{black!50!white}, % 设置注释样式，斜体，浅灰色
    stringstyle=\bfseries\color{PineGreen!90!black}, % 设置字符串样式
    columns=flexible,
    numbers=left, % 显示行号在左边
    numbersep=2em, % 设置行号的具体位置
    numberstyle=\footnotesize, % 缩小行号
    frame=shadowbox, % 边框
    rulesepcolor=\color{red!20!green!20!blue!20}, 
    % framesep=1em % 设置代码与边框的距离
    showstringspaces=false
}

\lstloadlanguages{C,C++,Java,Matlab,python,Mathematica}

      
% 参考文献
\setbeamertemplate{bibliography item}[text]
\newcommand{\reference}{
    \nocite{*}   %打开此选项会列出bib里面的所有参考文献
    \bibliographystyle{unsrt} %规定了参考文献的格式
    \begin{center}%居中
    	\bibliography{references} %调出LaTeX生成参考文献列表
    \end{center}
}